var de=Object.defineProperty;var fe=(i,r,e)=>r in i?de(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var $=(i,r,e)=>(fe(i,typeof r!="symbol"?r+"":r,e),e);var O=(i,r,e)=>{if(r.has(i))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(i):r.set(i,e)};import{d as k,l as f,q as c,u as R,F as G,x as N,z as ce,y as p,o as ee,t as g,b as K,r as B,m as H,j as te,v as se,s as P,p as re,c as D,n as pe}from"./mc55b2a42316522d6.js";import{u as v,r as M}from"./m6bdda40d8bd2cf5a.js";import{K as W,J as ie}from"./ma6cfd38af5d4c661.js";import{_ as E}from"./_plugin-vue_export-helper.js";import{B as q,a as d}from"./app.js";import{m as _}from"./api.js";import{d as me}from"./m21bbc25c9f3922b4.js";import{a as ge}from"./strings.js";const ve=["innerHTML"],be=k({inheritAttrs:!1,__name:"Label",props:{field:{}},setup(i){return(r,e)=>(f(),c("label",R({class:"form-label"},r.$attrs,{innerHTML:r.field.htmlLabel}),null,16,ve))}}),ye=E(be,[["__file","Label.vue"]]),we={key:0},_e=k({inheritAttrs:!1,__name:"Error",props:{field:{}},setup(i){return(r,e)=>r.field.hasErrors?(f(),c("div",R({key:0,class:"invalid-feedback d-block"},r.$attrs),[r.field.errors.length>1?(f(),c("ul",we,[(f(!0),c(G,null,N(r.field.errors,(t,s)=>(f(),c("li",{key:s},W(t),1))),128))])):(f(),c(G,{key:1},[ce(W(r.field.errors.join("")),1)],64))],16)):p("",!0)}}),ke=E(_e,[["__file","Error.vue"]]),Ee=["innerHTML"],$e=k({inheritAttrs:!1,__name:"Hint",props:{field:{}},setup(i){return(r,e)=>r.field.hint?(f(),c("div",{key:0,innerHTML:r.field.hint,class:"pb-2 text-muted"},null,8,Ee)):p("",!0)}}),Oe=E($e,[["__file","Hint.vue"]]),Se={class:"input-group"},Me={key:0,class:"input-group-text"},Ae={key:2,class:"input-group-text"},Te=k({inheritAttrs:!1,__name:"FieldWrapper",props:{field:{},noLabel:{type:Boolean,default:!1}},setup(i){var t;const r=te();(t=i.field)==null||t.events.afterValidate.listen(()=>{var s;(s=r==null?void 0:r.proxy)==null||s.$forceUpdate()});const e=ge(`${i.field.name}`);return ee(()=>{i.field&&r&&(i.field.component=r)}),(s,a)=>s.field?(f(),c("div",R({key:0,class:["field-wrapper",{[`field-wrapper-${s.field.name}`]:!0}]},s.$attrs),[s.field&&!s.noLabel?g(s.$slots,"label",{key:0},()=>[K(ye,{field:s.field,for:v(e)},null,8,["field","for"])]):p("",!0),K(Oe,{field:s.field},null,8,["field"]),B("div",Se,[s.$slots.before?(f(),c("div",Me,[g(s.$slots,"before",{field:s.field})])):p("",!0),s.$slots.buttonBefore?g(s.$slots,"buttonBefore",{key:1,field:s.field}):p("",!0),g(s.$slots,"default",{id:v(e)}),s.$slots.after?(f(),c("div",Ae,[g(s.$slots,"after",{field:s.field})])):p("",!0),s.$slots.buttonAfter?g(s.$slots,"buttonAfter",{key:3,field:s.field}):p("",!0)]),s.field&&s.field.hasErrors?(f(),H(ke,{key:1,field:s.field},null,8,["field"])):p("",!0)],16)):p("",!0)}}),ae=E(Te,[["__file","FieldWrapper.vue"]]),Pe=["id","value","placeholder"],Re=k({inheritAttrs:!1,__name:"StringInput",props:{field:{},noLabel:{type:Boolean},placeholder:{}},setup(i,{expose:r}){const e=i,{field:t,noLabel:s=!1,placeholder:a=e.field.label}=e,n=M(null),l=u=>{t.update(u.target.value)},o=u=>{t.touch(u)},h=u=>{t.blur(u)};return r({input:()=>n.value}),(u,F)=>(f(),H(ae,{field:v(t),"no-label":v(s)},se({default:P(({id:A})=>[B("input",R({id:A,ref_key:"input",ref:n,class:["form-control",{"is-invalid":v(t).hasErrors}],value:v(t).value},u.$attrs,{onInput:l,onFocus:o,onBlur:h,autocomplete:"off",spellcheck:"false",placeholder:v(a)}),null,16,Pe)]),_:2},[N(u.$slots,(A,C)=>({name:C,fn:P(ue=>[g(u.$slots,C,ie(re({...ue})))])}))]),1032,["field","no-label"]))}}),At=E(Re,[["__file","StringInput.vue"]]);function Tt(i){const r=te();let e=M(null);const t=(l={})=>{const o=new i(l);o.events.afterValidate.listen(({sender:h})=>{var u;(u=r==null?void 0:r.proxy)==null||u.$forceUpdate()}),e.value=()=>o},s=()=>{e.value=null};return[D(()=>e.value?e.value():null),t,s]}function Fe(i){return!!i&&typeof i.then=="function"}const[De,z]=d(),[Le,je]=d(!1),[Ve,Ie]=d(i=>!0);class J extends q{constructor(r){super(),this.field=r,this.init()}init(){}static assign(r){const e=new this(r);return r.rule(e),e}enabled(r=e=>!0){return Ie(this,r),this}get isEnable(){const r=Ve(this);return typeof r=="function"?r(this):r}skipOnEmpty(){return je(this,!0),this}get isSkipOnEmpty(){return Le(this)}message(r){let e=null;if(typeof r=="string")e=r;else if(Array.isArray(r)){const[t,s]=r;e=t[s](this)}else typeof r=="function"&&(e=r(this));return Fe(e)?e.then(t=>{z(this,t)}):z(this,e),this}createErrorMessage(r){return(De(this)??this.defaultMessage).replace(new RegExp("{attribute}","gm"),r)}execute(){}runValidation(){return new Promise(async r=>{let e=!0,t=null;this.isEnable&&(this.execute(),e=await this.validate(),e||(t=this.createErrorMessage(this.field.label))),r({valid:e,field:this.field,message:t})})}}class Ue extends J{get defaultMessage(){return"{attribute} is required"}validate(){return new Promise(r=>{r(this.field.value!==""&&this.field.value!==null&&this.field.value!==void 0)})}}const[Ne,Be]=d(""),[He,qe]=d(""),[Je,Q]=d(null),[Ce,Ge]=d(""),[Ke,X]=d([]),[We,ze]=d([]),[Qe,Xe]=d(!1),[Ye,Ze]=d(!1),[xe,et]=d(null),ne=(i,r=null)=>{r||(r=i),i.events.beforeUpdate.dispatch({sender:r}),i.hasOwnProperty("parent")&&i.parent&&ne(i.parent,r)},le=(i,r=null)=>{r||(r=i),i.events.afterUpdate.dispatch({sender:r}),i.hasOwnProperty("parent")&&i.parent&&le(i.parent,r)};class Y extends q{constructor(e,t,s,a=""){super();$(this,"parent");Be(this,e),qe(this,t),Q(this,s),Ge(this,a)}update(e){ne(this),this.silentUpdate(e),Qe(this)&&this.validate(),le(this)}silentUpdate(e){Q(this,e)}get name(){return Ne(this)}get label(){return He(this)}get value(){return Je(this)}get hint(){return Ce(this)}get htmlLabel(){return`
        <span>${this.label}</span>
        ${this.rules.filter(e=>e instanceof Ue&&e.isEnable).length>0?`<strong class="required text" title="${this.label} is required">*</strong>`:""}
    `}rule(e){return ze(this,t=>(t.push(e),t)),this}get rules(){return We(this)}addError(...e){X(this,t=>[...new Set(t.concat(e))])}get errors(){return Ke(this)}clearErrors(){X(this,[])}get hasErrors(){return this.errors.length>0}touch(e=null){Xe(this,!0)}blur(e){e.target.value&&Ze(this,!0),Ye(this)&&this.validate()}set component(e){et(this,e)}forceUpdate(){var e,t;(t=(e=xe(this))==null?void 0:e.proxy)==null||t.$forceUpdate()}toString(){return JSON.stringify({name:this.name,label:this.label,value:this.value,hint:this.hint},null,2)}validate(){return new Promise(e=>{this.events.beforeValidate.dispatch({sender:this}),this.clearErrors(),Promise.all(this.rules.map(t=>t.runValidation())).then(t=>{const s=t.reduce((a,n)=>a&&n.valid,!0);if(!s){const a=t.filter(n=>n.message!==null).map(n=>n.message);this.events.beforeError.dispatch({sender:this,messages:a}),this.addError(...a),this.events.afterError.dispatch({sender:this,messages:a})}this.events.afterValidate.dispatch({sender:this,valid:s}),this.forceUpdate(),e(s)})})}}const[b,tt]=d({}),[Z,st]=d({}),[w,T]=d({});class Pt extends q{constructor(e,t=()=>{}){super();$(this,"validationRules",[]);$(this,"parent");this.initData=e,t(this),this.beforeCreate(),this.assignFieldsFromGetters(),this.generateRules(),this.afterCreate()}beforeCreate(){}afterCreate(){}[Symbol.iterator](){let e=-1;return{next:(function(){return e++,{done:this.fields.length===e,value:this.fields.at(e)}}).bind(this)}}assignFieldsFromGetters(){Object.getOwnPropertyNames(Object.getPrototypeOf(this)).filter(e=>this[e]instanceof Y).forEach(e=>{const t=this[e];this.setField(t)}),this.data=this.initData}generateRules(){for(let e of this.rules){let[t,s,a=n=>n]=e;t.forEach(n=>{this.validationRules.push(a(s.assign(n)))})}}setField(e){tt(this,t=>(e.parent=this,t[e.name]=e,t))}createField(e,t,s=""){Object.defineProperty(this,e,{writable:!1,value:this.field(e,t,s)})}get fields(){return[...Object.values(b(this)),...Object.values(w(this)).map(e=>e.model)]}get length(){return this.fields.length}updateData(e){for(let t in b(this))e.hasOwnProperty(t)&&b(this)[t].update(e[t]);T(this,t=>{for(let s in t)e.hasOwnProperty(s)&&(Array.isArray(t[s].model)?Array.isArray(e[s])&&e[s].forEach((a,n)=>{t[s].model[n]||t[s].unlimited&&t[s].model.push(t[s].factory(a))}):t[s].model.data=e[s]);return t})}set data(e){this.updateData(e)}generateData(){return{...this.objectToData(b(this),(e,t)=>e[t],e=>e.value),...this.objectToData(w(this),(e,t)=>e[t].model,e=>e.data)}}get data(){return this.controlData(this.generateData())}controlData(e){return e}objectToData(e,t=(a,n)=>a[n],s=a=>a.data){return Object.keys(e).map(a=>{const n=t(e,a);return Array.isArray(n)?{[a]:n.map(l=>s(l))}:{[a]:s(n)}}).reduce((a,n)=>(a={...a,...n},a),{})}get relations(){return w(this)}findField(e){var t;return(t=b(this))!=null&&t.hasOwnProperty(e)?b(this)[e]:null}field(e,t,s=null,a=""){return this.findField(e)??new Y(e,t,s,a)}hasOne(e,t){return T(this,s=>(s.hasOwnProperty(e)||(s[e]={factory:t,model:t(this.initData[e]??{}),unlimited:!1}),s[e].model.parent=this,s)),w(this)[e].model}hasMany(e,t,s=1){return T(this,a=>(a.hasOwnProperty(e)||(a[e]={factory:t,model:new Array(s).fill(null).map(()=>t(this.initData[e]??{})).map(n=>(n.parent=this,n)),unlimited:!0}),a)),w(this)[e].model}hasLocals(e){const t="locals";return T(this,s=>{var a,n,l,o,h;return s.hasOwnProperty(t)||(s[t]={factory:e,model:(h=(o=(l=(n=(a=_())==null?void 0:a.languages)==null?void 0:n.map)==null?void 0:l.call(n,u=>{var F;return e(((F=this.initData[t])==null?void 0:F.find(A=>A.language===u.value))??{language:u.value})}))==null?void 0:o.map)==null?void 0:h.call(o,u=>(u.parent=this,u)),unlimited:!1}),s}),w(this)[t].model}get errors(){const e=Z(this);for(let t in this.relations){const{model:s}=this.relations[t];if(Array.isArray(s))for(let a in s){const n=s[a];n.hasErrors&&(e[t]||(e[t]=[]),e[t].push({index:a,errors:n.errors}))}else s.hasErrors&&(e[t]=s.errors)}return e}get hasErrors(){return Object.keys(Z(this)).length>0}validate(){return new Promise(async e=>{this.events.beforeValidate.dispatch({sender:this}),this.fields.forEach(s=>{var a,n;Array.isArray(s)?s.forEach(l=>{var o,h;(h=(o=l.events)==null?void 0:o.beforeValidate)==null||h.dispatch({sender:this,field:l})}):(n=(a=s.events)==null?void 0:a.beforeValidate)==null||n.dispatch({sender:this,field:s})});const t=await this.validateModel(this);this.events.afterValidate.dispatch({sender:this}),this.fields.forEach(s=>{var a,n;Array.isArray(s)?s.forEach(l=>{var o,h;(h=(o=l.events)==null?void 0:o.afterValidate)==null||h.dispatch({sender:this,field:l})}):(n=(a=s.events)==null?void 0:a.afterValidate)==null||n.dispatch({sender:this,field:s})}),e(t)})}validateModel(e){return new Promise(async t=>{let s=!0;e.validationRules.forEach(a=>{a.field.clearErrors()});for await(const a of e.validationRules){const{valid:n,field:l,message:o}=await a.runValidation();s=s&&n,n||(st(this,h=>(h.hasOwnProperty(l.name)||(h[l.name]=[]),h[l.name].push(o),h)),a.field.addError(o),a.field.forceUpdate())}for(let a in e.relations){const n=e.relations[a].model;if(Array.isArray(n))for await(let l of n){const o=await l.validate();s=s&&o}else{const l=await n.validate();s=s&&l}}t(s)})}get primarykey(){var e;return((e=this.findField("id"))==null?void 0:e.value)??null}get isNewRecord(){return!this.primarykey}addRemoteErrors(e){if(Object.hasOwn(e,"xhr")&&Object.hasOwn(e.xhr,"responseJSON")&&typeof e.xhr.responseJSON=="object"&&Object.hasOwn(e.xhr.responseJSON,"details")&&typeof e.xhr.responseJSON.details=="object"){const t=b(this);Object.keys(e.xhr.responseJSON.details).forEach(s=>{if(Object.hasOwn(t,s)){const a=e.xhr.responseJSON.details[s];t[s].addError(...a),t[s].forceUpdate()}})}}getField(e){return this[e]??null}}const[rt,it]=d(),[m,at]=d(),[y,nt]=d(),[S,lt]=d();var j,V,I,U;class Rt extends J{constructor(){super(...arguments);O(this,j,void 0);O(this,V,void 0);O(this,I,void 0);O(this,U,void 0)}get isString(){return typeof this.field.value=="string"}execute(){this.isString&&rt(this)&&this.field.silentUpdate(this.field.value.trim())}trim(){return it(this,!0),this}min(e){return at(this,e),this}max(e){return nt(this,e),this}length(e){return lt(this,e),this}get defaultMessage(){if(this.isString){if(typeof m(this)<"u"&&typeof y(this)<"u"&&(this.field.value.length<m(this)||this.field.value.length>y(this)))return`{attribute} should be between ${m(this)} and ${y(this)} characters.`;if(typeof m(this)<"u"&&this.field.value.length<m(this))return`{attribute} should be bigger than or equal ${m(this)} characters.`;if(typeof y(this)<"u"&&this.field.value.length>y(this))return"{attribute} should be less than or equal $max(this)} characters.";if(typeof S(this)<"u"&&this.field.value.length!==S(this))return`{attribute} should be equal ${S(this)} characters.`}else return"{attribute} should be a string";return""}validate(){return new Promise(e=>{e(this.isString&&(!this.field.value&&this.isSkipOnEmpty||(typeof m(this)>"u"||this.field.value.length>=m(this))&&(typeof y(this)>"u"||this.field.value.length<=y(this))&&(typeof S(this)>"u"||this.field.value.length===S(this))))})}}j=new WeakMap,V=new WeakMap,I=new WeakMap,U=new WeakMap;function x(i,r,e){var t=new Date;t.setTime(t.getTime()+24*60*60*1e3*e),document.cookie=i+"="+r+";path=/;expires="+t.toString()}const ot=0,ht=1,ut=2,dt=["light","dark","auto"],oe=()=>{var i,r;return localStorage.getItem(`theme-${(r=(i=_)==null?void 0:i())==null?void 0:r.tier}`)},ft=i=>{var r,e;localStorage.setItem(`theme-${(e=(r=_)==null?void 0:r())==null?void 0:e.tier}`,i)},L=()=>{const i=oe();return i||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},he=i=>{var r,e,t,s;i==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.setAttribute("data-bs-theme","dark"),x(`theme-${(e=(r=_)==null?void 0:r())==null?void 0:e.tier}`,"dark",73200)):(document.documentElement.setAttribute("data-bs-theme",i),x(`theme-${(s=(t=_)==null?void 0:t())==null?void 0:s.tier}`,i,73200))},ct=me("theme",()=>{const i=M(L()==="dark"?ht:L()==="light"?ot:ut),r=D(()=>dt[i.value%3]),e=D(()=>r.value==="dark"||window.matchMedia("(prefers-color-scheme: dark)").matches&&r.value==="auto");return{theme:r,isDarkTheme:e,changeTheme:()=>{i.value++,pe(()=>{ft(r.value),he(r.value)})}}});function pt(){return ct().isDarkTheme}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const i=oe();i!=="light"&&i!=="dark"&&he(L())});class mt extends J{constructor(){super(...arguments);$(this,"widget",null)}get defaultMessage(){return"{attribute} not verified"}validate(){return new Promise(e=>{const t=window.grecaptcha.getResponse(this.widget);e(t)})}}const gt=["id"],vt=()=>{const i="https://www.google.com/recaptcha/api.js";let r=document.querySelector(`script[src="${i}"]`);r||(r=document.createElement("script"),r.async=!0,r.src=i,document.head.appendChild(r)),typeof window.grecaptcha>"u"&&(window.grecaptcha={}),window.grecaptcha.ready=e=>{if(typeof window.grecaptcha>"u"){const t="___grecaptcha_cfg";window[t]=window[t]||{},(window[t].fns=window[t].fns||[]).push(e)}else e()}};vt();const bt=k({inheritAttrs:!1,__name:"RecaptchaInput",props:{field:{}},setup(i){const r=i,{field:e}=r,t=M(null),s=M(null);return ee(()=>{var a,n;(n=(a=window.grecaptcha)==null?void 0:a.ready)==null||n.call(a,()=>{var o,h,u;s.value=(u=(o=window.grecaptcha)==null?void 0:o.render)==null?void 0:u.call(o,t.value,{sitekey:(h=_())==null?void 0:h.recaptchaSiteKey,theme:pt()?"dark":"light"});const l=mt.assign(e);e.parent.validationRules.push(l),l.widget=s.value})}),(a,n)=>(f(),H(ae,{field:v(e),"no-label":""},se({default:P(({id:l})=>[B("div",{id:l,ref_key:"container",ref:t},null,8,gt)]),_:2},[N(a.$slots,(l,o)=>({name:o,fn:P(h=>[g(a.$slots,o,ie(re({...h})))])}))]),1032,["field"]))}});const Ft=E(bt,[["__file","RecaptchaInput.vue"]]);export{ae as F,Pt as M,Ft as R,At as S,Rt as a,Ue as b,Tt as c};
//# sourceMappingURL=RecaptchaInput.js.map
