{"version":3,"file":"app.js","sources":["../../../../resources/js/lib/private.ts","../../../../resources/js/lib/event-dispatcher.ts","../../../../resources/js/lib/base.ts","../../../../resources/js/lib/pinia.ts","../../../../resources/js/lib/app.ts"],"sourcesContent":["type GetType<T, Q> = (sender: T) => Q;\ntype SetType<T, Q> = (sender: T, value: any | ((value: Q) => Q)) => void;\ntype SetValue<T> = T extends any ? T | (() => T) : boolean;\n\nexport function createPrivateField<T extends {}, Q extends unknown = unknown>(\n  initialValue?: Q\n): [GetType<T, Q>, SetType<T, Q>] {\n  const fields = new WeakMap<T, Q>();\n\n  const get = (sender: T): Q => {\n    if (!fields.has(sender)) {\n      let value: any =\n        typeof initialValue === \"function\" ? initialValue() : initialValue;\n      if (Array.isArray(value)) {\n        value = [...value];\n      } else if (typeof value === \"object\") {\n        value = { ...value };\n      }\n      fields.set(sender, value);\n    }\n    return fields.get(sender) as Q;\n  };\n\n  const set = (sender: T, value: SetValue<Q>): void => {\n    if (typeof value === \"function\") {\n      fields.set(sender, value(get(sender)));\n    } else {\n      fields.set(sender, value as Q);\n    }\n  };\n\n  const out: [GetType<T, Q>, SetType<T, Q>] = [get, set];\n\n  return out;\n}\n","import { createPrivateField } from \"@/lib/private\"\n\nconst [active, setActive] = createPrivateField<EventDispatcher, boolean>(true)\nconst [events, setEvents] = createPrivateField<\n\tEventDispatcher,\n\tEventListen[]\n>([])\n\ntype EventListen<Args extends {} = {}> = (params: { [name in keyof Args]?: Args[name] }) => void\n\nexport class EventDispatcher<Args extends {} = {}> {\n\tconstructor(public name: string, public sender: any) {\n\t\tsetActive(this, true)\n\t\tsetEvents(this, [])\n\t}\n\n\tlisten(callback: EventListen<Args>) {\n\t\tsetEvents(this, (events: EventListen<Args>[]) => {\n\t\t\tevents.push(callback)\n            return events\n\t\t})\n\t}\n\n\tdispatch(params: { [name in keyof Args]?: Args[name] } = {}) {\n\t\tif (active(this)) {\n\t\t\tevents(this).forEach((callback: EventListen<Args>) => {\n\t\t\t\tcallback(params)\n\t\t\t})\n\t\t}\n\t}\n\n\tactivate() {\n\t\tsetActive(this, true)\n\t}\n\n\tdeactivate() {\n\t\tsetActive(this, false)\n\t}\n}\n","import { EventDispatcher } from \"@/lib/event-dispatcher\";\n\nexport class Base<Events extends {} = {}> {\n  events: Events;\n\n  constructor(private _baseName?: string) {\n    if (!_baseName) {\n      this._baseName = this.constructor.name;\n    }\n    this.events = this.defineEvents();\n    this.init();\n  }\n\n  init() {}\n\n  get className(): string {\n    return this._baseName as string;\n  }\n\n  protected set className(name: string) {\n    this._baseName = name;\n  }\n\n  protected defineEvents(): Events {\n    return new Proxy<Events>({} as Events, {\n      get: (target: any, property: string, receiver: any) => {\n        if (!target.hasOwnProperty(property)) {\n          Reflect.set(\n            target,\n            property,\n            new EventDispatcher(property, this),\n            receiver\n          );\n        }\n        return Reflect.get(target, property, receiver);\n      },\n    });\n  }\n}\n","import { createPinia } from \"pinia\";\n\nexport const pinia = createPinia();\n","import { EventDispatcher } from \"@/lib/event-dispatcher\";\nimport { Base } from \"@/lib/base\";\nimport { pinia } from \"@/lib/pinia\";\nimport {\n  App as VueApp,\n  ComponentPublicInstance,\n  createApp as createVueApp,\n} from \"vue\";\n\ndeclare var window: any;\n\nwindow.codendot = window.codendot ?? {};\nwindow.codendot.vueApps = window.codendot.vueApps ?? {}; \n\ntype Events = {\n  init: EventDispatcher<{sender: Application}>;\n  start: EventDispatcher<{sender: Application}>;\n  mount: EventDispatcher<{sender: Application, vue: VueApp<Element>}>;\n  mounted: EventDispatcher<{sender: Application, vue: VueApp<Element>}>;\n};\n\nclass Application extends Base<Events> {\n  constructor(public name: string, public component: any) {\n    super(\"@/lib/Application\");\n  }\n\n  mount() {\n    this.events.init.dispatch({ sender: this });\n\n    window.codendot.vueApps[this.name] = (\n      id: string,\n      params: { [name: string]: any }\n    ): Promise<VueApp<Element>> => {\n      return new Promise((resolve) => {\n        this.events.start.dispatch({ sender: this });\n\n        const app: VueApp<Element> = createVueApp(this.component, params);\n\n        app.config.globalProperties.$params = params;\n\n        app.provide(\"app\", app);\n\n        // On Warning\n        app.config.warnHandler = (\n          msg: string,\n          instance: ComponentPublicInstance | null,\n          trace: string\n        ) => {\n          // warnInfo(msg, instance, trace)\n          console.warn(msg, instance, trace)\n        };\n\n        // On Error\n        app.config.errorHandler = (\n          err: any,\n          instance: ComponentPublicInstance | null,\n          info: string\n        ) => {\n          // errorInfo(err, instance, info)\n          console.error(err, instance, info)\n        };\n\n        app.use(pinia);\n\n        this.events.mount.dispatch({ vue: app, sender: this });\n\n        app.mount(`#${id}`);\n\n        this.events.mounted.dispatch({ vue: app, sender: this });\n\n        resolve(app);\n      });\n    };\n  }\n}\n\nexport type App = InstanceType<typeof Application>;\n\nexport const createApp = (name: string, component: any) => {\n  return new Application(name, component);\n};\n"],"names":["createPrivateField","initialValue","fields","get","sender","value","active","setActive","events","setEvents","EventDispatcher","name","callback","params","Base","_baseName","__publicField","target","property","receiver","pinia","createPinia","Application","component","id","resolve","app","createVueApp","msg","instance","trace","err","info","createApp"],"mappings":"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"}