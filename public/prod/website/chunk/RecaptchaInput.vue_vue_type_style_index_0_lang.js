var de=Object.defineProperty;var ue=(i,r,e)=>r in i?de(i,r,{enumerable:!0,configurable:!0,writable:!0,value:e}):i[r]=e;var E=(i,r,e)=>(ue(i,typeof r!="symbol"?r+"":r,e),e);var O=(i,r,e)=>{if(r.has(i))throw TypeError("Cannot add the same private member more than once");r instanceof WeakSet?r.add(i):r.set(i,e)};import{d as $,l as f,q as c,u as P,F as C,x as N,z as fe,y as p,o as x,t as g,b as G,r as B,m as I,j as ee,v as te,s as T,p as se,c as D,n as ce}from"./mc55b2a42316522d6.js";import{u as v,r as S}from"./m6bdda40d8bd2cf5a.js";import{K,J as re}from"./ma6cfd38af5d4c661.js";import{B as H,a as u}from"./app.js";import{m as k}from"./api.js";import{d as pe}from"./m21bbc25c9f3922b4.js";import{a as me}from"./strings.js";const ge=["innerHTML"],ve=$({inheritAttrs:!1,__name:"Label",props:{field:{}},setup(i){return(r,e)=>(f(),c("label",P({class:"form-label"},r.$attrs,{innerHTML:r.field.htmlLabel}),null,16,ge))}}),ye={key:0},be=$({inheritAttrs:!1,__name:"Error",props:{field:{}},setup(i){return(r,e)=>r.field.hasErrors?(f(),c("div",P({key:0,class:"invalid-feedback d-block"},r.$attrs),[r.field.errors.length>1?(f(),c("ul",ye,[(f(!0),c(C,null,N(r.field.errors,(t,s)=>(f(),c("li",{key:s},K(t),1))),128))])):(f(),c(C,{key:1},[fe(K(r.field.errors.join("")),1)],64))],16)):p("",!0)}}),we=["innerHTML"],ke=$({inheritAttrs:!1,__name:"Hint",props:{field:{}},setup(i){return(r,e)=>r.field.hint?(f(),c("div",{key:0,innerHTML:r.field.hint,class:"pb-2 text-muted"},null,8,we)):p("",!0)}}),$e={class:"input-group"},Ee={key:0,class:"input-group-text"},Oe={key:2,class:"input-group-text"},ie=$({inheritAttrs:!1,__name:"FieldWrapper",props:{field:{},noLabel:{type:Boolean,default:!1}},setup(i){var t;const r=ee();(t=i.field)==null||t.events.afterValidate.listen(()=>{var s;(s=r==null?void 0:r.proxy)==null||s.$forceUpdate()});const e=me(`${i.field.name}`);return x(()=>{i.field&&r&&(i.field.component=r)}),(s,a)=>s.field?(f(),c("div",P({key:0,class:["field-wrapper",{[`field-wrapper-${s.field.name}`]:!0}]},s.$attrs),[s.field&&!s.noLabel?g(s.$slots,"label",{key:0},()=>[G(ve,{field:s.field,for:v(e)},null,8,["field","for"])]):p("",!0),G(ke,{field:s.field},null,8,["field"]),B("div",$e,[s.$slots.before?(f(),c("div",Ee,[g(s.$slots,"before",{field:s.field})])):p("",!0),s.$slots.buttonBefore?g(s.$slots,"buttonBefore",{key:1,field:s.field}):p("",!0),g(s.$slots,"default",{id:v(e)}),s.$slots.after?(f(),c("div",Oe,[g(s.$slots,"after",{field:s.field})])):p("",!0),s.$slots.buttonAfter?g(s.$slots,"buttonAfter",{key:3,field:s.field}):p("",!0)]),s.field&&s.field.hasErrors?(f(),I(be,{key:1,field:s.field},null,8,["field"])):p("",!0)],16)):p("",!0)}}),_e=["id","value","placeholder"],wt=$({inheritAttrs:!1,__name:"StringInput",props:{field:{},noLabel:{type:Boolean},placeholder:{}},setup(i,{expose:r}){const e=i,{field:t,noLabel:s=!1,placeholder:a=e.field.label}=e,n=S(null),l=d=>{t.update(d.target.value)},o=d=>{t.touch(d)},h=d=>{t.blur(d)};return r({input:()=>n.value}),(d,R)=>(f(),I(ie,{field:v(t),"no-label":v(s)},te({default:T(({id:M})=>[B("input",P({id:M,ref_key:"input",ref:n,class:["form-control",{"is-invalid":v(t).hasErrors}],value:v(t).value},d.$attrs,{onInput:l,onFocus:o,onBlur:h,autocomplete:"off",spellcheck:"false",placeholder:v(a)}),null,16,_e)]),_:2},[N(d.$slots,(M,J)=>({name:J,fn:T(he=>[g(d.$slots,J,re(se({...he})))])}))]),1032,["field","no-label"]))}});function kt(i){const r=ee();let e=S(null);const t=(l={})=>{const o=new i(l);o.events.afterValidate.listen(({sender:h})=>{var d;(d=r==null?void 0:r.proxy)==null||d.$forceUpdate()}),e.value=()=>o},s=()=>{e.value=null};return[D(()=>e.value?e.value():null),t,s]}function Se(i){return!!i&&typeof i.then=="function"}const[Me,z]=u(),[Ae,Te]=u(!1),[Pe,Re]=u(i=>!0);class q extends H{constructor(r){super(),this.field=r,this.init()}init(){}static assign(r){const e=new this(r);return r.rule(e),e}enabled(r=e=>!0){return Re(this,r),this}get isEnable(){const r=Pe(this);return typeof r=="function"?r(this):r}skipOnEmpty(){return Te(this,!0),this}get isSkipOnEmpty(){return Ae(this)}message(r){let e=null;if(typeof r=="string")e=r;else if(Array.isArray(r)){const[t,s]=r;e=t[s](this)}else typeof r=="function"&&(e=r(this));return Se(e)?e.then(t=>{z(this,t)}):z(this,e),this}createErrorMessage(r){return(Me(this)??this.defaultMessage).replace(new RegExp("{attribute}","gm"),r)}execute(){}runValidation(){return new Promise(async r=>{let e=!0,t=null;this.isEnable&&(this.execute(),e=await this.validate(),e||(t=this.createErrorMessage(this.field.label))),r({valid:e,field:this.field,message:t})})}}class De extends q{get defaultMessage(){return"{attribute} is required"}validate(){return new Promise(r=>{r(this.field.value!==""&&this.field.value!==null&&this.field.value!==void 0)})}}const[je,Ve]=u(""),[Fe,Le]=u(""),[Ue,W]=u(null),[Ne,Be]=u(""),[Ie,Q]=u([]),[He,qe]=u([]),[Je,Ce]=u(!1),[Ge,Ke]=u(!1),[ze,We]=u(null),ae=(i,r=null)=>{r||(r=i),i.events.beforeUpdate.dispatch({sender:r}),i.hasOwnProperty("parent")&&i.parent&&ae(i.parent,r)},ne=(i,r=null)=>{r||(r=i),i.events.afterUpdate.dispatch({sender:r}),i.hasOwnProperty("parent")&&i.parent&&ne(i.parent,r)};class X extends H{constructor(e,t,s,a=""){super();E(this,"parent");Ve(this,e),Le(this,t),W(this,s),Be(this,a)}update(e){ae(this),this.silentUpdate(e),Je(this)&&this.validate(),ne(this)}silentUpdate(e){W(this,e)}get name(){return je(this)}get label(){return Fe(this)}get value(){return Ue(this)}get hint(){return Ne(this)}get htmlLabel(){return`
        <span>${this.label}</span>
        ${this.rules.filter(e=>e instanceof De&&e.isEnable).length>0?`<strong class="required text" title="${this.label} is required">*</strong>`:""}
    `}rule(e){return qe(this,t=>(t.push(e),t)),this}get rules(){return He(this)}addError(...e){Q(this,t=>[...new Set(t.concat(e))])}get errors(){return Ie(this)}clearErrors(){Q(this,[])}get hasErrors(){return this.errors.length>0}touch(e=null){Ce(this,!0)}blur(e){e.target.value&&Ke(this,!0),Ge(this)&&this.validate()}set component(e){We(this,e)}forceUpdate(){var e,t;(t=(e=ze(this))==null?void 0:e.proxy)==null||t.$forceUpdate()}toString(){return JSON.stringify({name:this.name,label:this.label,value:this.value,hint:this.hint},null,2)}validate(){return new Promise(e=>{this.events.beforeValidate.dispatch({sender:this}),this.clearErrors(),Promise.all(this.rules.map(t=>t.runValidation())).then(t=>{const s=t.reduce((a,n)=>a&&n.valid,!0);if(!s){const a=t.filter(n=>n.message!==null).map(n=>n.message);this.events.beforeError.dispatch({sender:this,messages:a}),this.addError(...a),this.events.afterError.dispatch({sender:this,messages:a})}this.events.afterValidate.dispatch({sender:this,valid:s}),this.forceUpdate(),e(s)})})}}const[y,Qe]=u({}),[Y,Xe]=u({}),[w,A]=u({});class $t extends H{constructor(e,t=()=>{}){super();E(this,"validationRules",[]);E(this,"parent");this.initData=e,t(this),this.beforeCreate(),this.assignFieldsFromGetters(),this.generateRules(),this.afterCreate()}beforeCreate(){}afterCreate(){}[Symbol.iterator](){let e=-1;return{next:(function(){return e++,{done:this.fields.length===e,value:this.fields.at(e)}}).bind(this)}}assignFieldsFromGetters(){Object.getOwnPropertyNames(Object.getPrototypeOf(this)).filter(e=>this[e]instanceof X).forEach(e=>{const t=this[e];this.setField(t)}),this.data=this.initData}generateRules(){for(let e of this.rules){let[t,s,a=n=>n]=e;t.forEach(n=>{this.validationRules.push(a(s.assign(n)))})}}setField(e){Qe(this,t=>(e.parent=this,t[e.name]=e,t))}createField(e,t,s=""){Object.defineProperty(this,e,{writable:!1,value:this.field(e,t,s)})}get fields(){return[...Object.values(y(this)),...Object.values(w(this)).map(e=>e.model)]}get length(){return this.fields.length}updateData(e){for(let t in y(this))e.hasOwnProperty(t)&&y(this)[t].update(e[t]);A(this,t=>{for(let s in t)e.hasOwnProperty(s)&&(Array.isArray(t[s].model)?Array.isArray(e[s])&&e[s].forEach((a,n)=>{t[s].model[n]||t[s].unlimited&&t[s].model.push(t[s].factory(a))}):t[s].model.data=e[s]);return t})}set data(e){this.updateData(e)}generateData(){return{...this.objectToData(y(this),(e,t)=>e[t],e=>e.value),...this.objectToData(w(this),(e,t)=>e[t].model,e=>e.data)}}get data(){return this.controlData(this.generateData())}controlData(e){return e}objectToData(e,t=(a,n)=>a[n],s=a=>a.data){return Object.keys(e).map(a=>{const n=t(e,a);return Array.isArray(n)?{[a]:n.map(l=>s(l))}:{[a]:s(n)}}).reduce((a,n)=>(a={...a,...n},a),{})}get relations(){return w(this)}findField(e){var t;return(t=y(this))!=null&&t.hasOwnProperty(e)?y(this)[e]:null}field(e,t,s=null,a=""){return this.findField(e)??new X(e,t,s,a)}hasOne(e,t){return A(this,s=>(s.hasOwnProperty(e)||(s[e]={factory:t,model:t(this.initData[e]??{}),unlimited:!1}),s[e].model.parent=this,s)),w(this)[e].model}hasMany(e,t,s=1){return A(this,a=>(a.hasOwnProperty(e)||(a[e]={factory:t,model:new Array(s).fill(null).map(()=>t(this.initData[e]??{})).map(n=>(n.parent=this,n)),unlimited:!0}),a)),w(this)[e].model}hasLocals(e){const t="locals";return A(this,s=>{var a,n,l,o,h;return s.hasOwnProperty(t)||(s[t]={factory:e,model:(h=(o=(l=(n=(a=k())==null?void 0:a.languages)==null?void 0:n.map)==null?void 0:l.call(n,d=>{var R;return e(((R=this.initData[t])==null?void 0:R.find(M=>M.language===d.value))??{language:d.value})}))==null?void 0:o.map)==null?void 0:h.call(o,d=>(d.parent=this,d)),unlimited:!1}),s}),w(this)[t].model}get errors(){const e=Y(this);for(let t in this.relations){const{model:s}=this.relations[t];if(Array.isArray(s))for(let a in s){const n=s[a];n.hasErrors&&(e[t]||(e[t]=[]),e[t].push({index:a,errors:n.errors}))}else s.hasErrors&&(e[t]=s.errors)}return e}get hasErrors(){return Object.keys(Y(this)).length>0}validate(){return new Promise(async e=>{this.events.beforeValidate.dispatch({sender:this}),this.fields.forEach(s=>{var a,n;Array.isArray(s)?s.forEach(l=>{var o,h;(h=(o=l.events)==null?void 0:o.beforeValidate)==null||h.dispatch({sender:this,field:l})}):(n=(a=s.events)==null?void 0:a.beforeValidate)==null||n.dispatch({sender:this,field:s})});const t=await this.validateModel(this);this.events.afterValidate.dispatch({sender:this}),this.fields.forEach(s=>{var a,n;Array.isArray(s)?s.forEach(l=>{var o,h;(h=(o=l.events)==null?void 0:o.afterValidate)==null||h.dispatch({sender:this,field:l})}):(n=(a=s.events)==null?void 0:a.afterValidate)==null||n.dispatch({sender:this,field:s})}),e(t)})}validateModel(e){return new Promise(async t=>{let s=!0;e.validationRules.forEach(a=>{a.field.clearErrors()});for await(const a of e.validationRules){const{valid:n,field:l,message:o}=await a.runValidation();s=s&&n,n||(Xe(this,h=>(h.hasOwnProperty(l.name)||(h[l.name]=[]),h[l.name].push(o),h)),a.field.addError(o),a.field.forceUpdate())}for(let a in e.relations){const n=e.relations[a].model;if(Array.isArray(n))for await(let l of n){const o=await l.validate();s=s&&o}else{const l=await n.validate();s=s&&l}}t(s)})}get primarykey(){var e;return((e=this.findField("id"))==null?void 0:e.value)??null}get isNewRecord(){return!this.primarykey}addRemoteErrors(e){if(Object.hasOwn(e,"xhr")&&Object.hasOwn(e.xhr,"responseJSON")&&typeof e.xhr.responseJSON=="object"&&Object.hasOwn(e.xhr.responseJSON,"details")&&typeof e.xhr.responseJSON.details=="object"){const t=y(this);Object.keys(e.xhr.responseJSON.details).forEach(s=>{if(Object.hasOwn(t,s)){const a=e.xhr.responseJSON.details[s];t[s].addError(...a),t[s].forceUpdate()}})}}getField(e){return this[e]??null}}const[Ye,Ze]=u(),[m,xe]=u(),[b,et]=u(),[_,tt]=u();var V,F,L,U;class Et extends q{constructor(){super(...arguments);O(this,V,void 0);O(this,F,void 0);O(this,L,void 0);O(this,U,void 0)}get isString(){return typeof this.field.value=="string"}execute(){this.isString&&Ye(this)&&this.field.silentUpdate(this.field.value.trim())}trim(){return Ze(this,!0),this}min(e){return xe(this,e),this}max(e){return et(this,e),this}length(e){return tt(this,e),this}get defaultMessage(){if(this.isString){if(typeof m(this)<"u"&&typeof b(this)<"u"&&(this.field.value.length<m(this)||this.field.value.length>b(this)))return`{attribute} should be between ${m(this)} and ${b(this)} characters.`;if(typeof m(this)<"u"&&this.field.value.length<m(this))return`{attribute} should be bigger than or equal ${m(this)} characters.`;if(typeof b(this)<"u"&&this.field.value.length>b(this))return"{attribute} should be less than or equal $max(this)} characters.";if(typeof _(this)<"u"&&this.field.value.length!==_(this))return`{attribute} should be equal ${_(this)} characters.`}else return"{attribute} should be a string";return""}validate(){return new Promise(e=>{e(this.isString&&(!this.field.value&&this.isSkipOnEmpty||(typeof m(this)>"u"||this.field.value.length>=m(this))&&(typeof b(this)>"u"||this.field.value.length<=b(this))&&(typeof _(this)>"u"||this.field.value.length===_(this))))})}}V=new WeakMap,F=new WeakMap,L=new WeakMap,U=new WeakMap;function Z(i,r,e){var t=new Date;t.setTime(t.getTime()+24*60*60*1e3*e),document.cookie=i+"="+r+";path=/;expires="+t.toString()}const st=0,rt=1,it=2,at=["light","dark","auto"],le=()=>{var i,r;return localStorage.getItem(`theme-${(r=(i=k)==null?void 0:i())==null?void 0:r.tier}`)},nt=i=>{var r,e;localStorage.setItem(`theme-${(e=(r=k)==null?void 0:r())==null?void 0:e.tier}`,i)},j=()=>{const i=le();return i||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")},oe=i=>{var r,e,t,s;i==="auto"&&window.matchMedia("(prefers-color-scheme: dark)").matches?(document.documentElement.setAttribute("data-bs-theme","dark"),Z(`theme-${(e=(r=k)==null?void 0:r())==null?void 0:e.tier}`,"dark",73200)):(document.documentElement.setAttribute("data-bs-theme",i),Z(`theme-${(s=(t=k)==null?void 0:t())==null?void 0:s.tier}`,i,73200))},lt=pe("theme",()=>{const i=S(j()==="dark"?rt:j()==="light"?st:it),r=D(()=>at[i.value%3]),e=D(()=>r.value==="dark"||window.matchMedia("(prefers-color-scheme: dark)").matches&&r.value==="auto");return{theme:r,isDarkTheme:e,changeTheme:()=>{i.value++,ce(()=>{nt(r.value),oe(r.value)})}}});function ot(){return lt().isDarkTheme}window.matchMedia("(prefers-color-scheme: dark)").addEventListener("change",()=>{const i=le();i!=="light"&&i!=="dark"&&oe(j())});class ht extends q{constructor(){super(...arguments);E(this,"widget",null)}get defaultMessage(){return"{attribute} not verified"}validate(){return new Promise(e=>{const t=window.grecaptcha.getResponse(this.widget);e(t)})}}const dt=["id"],ut=()=>{const i="https://www.google.com/recaptcha/api.js";let r=document.querySelector(`script[src="${i}"]`);r||(r=document.createElement("script"),r.async=!0,r.src=i,document.head.appendChild(r)),typeof window.grecaptcha>"u"&&(window.grecaptcha={}),window.grecaptcha.ready=e=>{if(typeof window.grecaptcha>"u"){const t="___grecaptcha_cfg";window[t]=window[t]||{},(window[t].fns=window[t].fns||[]).push(e)}else e()}};ut();const Ot=$({inheritAttrs:!1,__name:"RecaptchaInput",props:{field:{}},setup(i){const r=i,{field:e}=r,t=S(null),s=S(null);return x(()=>{var a,n;(n=(a=window.grecaptcha)==null?void 0:a.ready)==null||n.call(a,()=>{var o,h,d;s.value=(d=(o=window.grecaptcha)==null?void 0:o.render)==null?void 0:d.call(o,t.value,{sitekey:(h=k())==null?void 0:h.recaptchaSiteKey,theme:ot()?"dark":"light"});const l=ht.assign(e);e.parent.validationRules.push(l),l.widget=s.value})}),(a,n)=>(f(),I(ie,{field:v(e),"no-label":""},te({default:T(({id:l})=>[B("div",{id:l,ref_key:"container",ref:t},null,8,dt)]),_:2},[N(a.$slots,(l,o)=>({name:o,fn:T(h=>[g(a.$slots,o,re(se({...h})))])}))]),1032,["field"]))}});export{$t as M,De as R,Et as S,ie as _,wt as a,Ot as b,kt as c};
